.\" NOTE:  changes to the manual page for "pg_top" should be made in the
.\"        file "pg_top.1.in" and NOT in the file "pg_top.1".
.nr N 10
.nr D 5
.TH PG_TOP 1 Local
.UC 4
.SH NAME
pg_top \- display and update information about the top cpu PostgreSQL processes
.SH SYNOPSIS
.B pg_top
[ OPTIONS ] [ NUMBER ]
.SH DESCRIPTION
.\" This defines appropriate quote strings for nroff and troff
.ds lq \&"
.ds rq \&"
.if t .ds lq ``
.if t .ds rq ''
.\" Just in case these number registers aren't set yet...
.if \nN==0 .nr N 10
.if \nD==0 .nr D 5
.I pg_top
displays the top processes on the system and periodically updates this
information.
.if \nN==-1 \
\{\
If standard output is an intelligent terminal (see below) then
as many processes as will fit on the terminal screen are displayed
by default.  Otherwise, a good number of them are shown (around 20).
.\}
Raw cpu percentage is used to rank the processes.  If
.I number
is given, then the top
.I number
processes will be displayed instead of the default.
.PP
.I pg_top
makes a distinction between terminals that support advanced capabilities
and those that do not.  This
distinction affects the choice of defaults for certain options.  In the
remainder of this document, an \*(lqintelligent\*(rq terminal is one that
supports cursor addressing, clear screen, and clear to end of line.
Conversely, a \*(lqdumb\*(rq terminal is one that does not support such
features.  If the output of
.I pg_top
is redirected to a file, it acts as if it were being run on a dumb
terminal.
.SH OPTIONS
.TP
.B \-C, \-\-color-mode
Turn off the use of color in the display.
.TP
.B \-I, \-\-hide-idle
Do not display idle processes.
By default, pg_top displays both active and idle processes.
.TP
.B \-T, \-\-show-tags
List all available color tags and the current set of tests used for
color highlighting, then exit.
.TP
.B \-W, \-\-password
Forces pg_top to prompt for a password before connecting to a database.  pg_top
will also keep the database connection open while running, and will clear the
database connection from memory for security.
.TP
.B \-b, \-\-batch
Use \*(lqbatch\*(rq mode.  In this mode, all input from the terminal is
ignored.  Interrupt characters (such as ^C and ^\e) still have an effect.
This is the default on a dumb terminal, or when the output is not a terminal.
.TP
.B \-c, \-\-show-command
Show the command name for each process. Default is to show the full
command line.  This option is not supported on all platforms.
.TP
.B \-i, \-\-interactive
Use \*(lqinteractive\*(rq mode.  In this mode, any input is immediately
read for processing.  See the section on \*(lqInteractive Mode\*(rq
for an explanation of
which keys perform what functions.  After the command is processed, the
screen will immediately be updated, even if the command was not
understood.  This mode is the default when standard output is an
intelligent terminal.
.TP
.B \-n, \-\-non-interactive
Use \*(lqnon-interactive\*(rq mode.  This is indentical to \*(lqbatch\*(rq
mode.
.TP
.B \-r, \-\-remote-mode
Monitor a remote database where the database is on a system other than where
pg_top is running from.
.I pg_top
will monitor a remote database if it has the pg_proctab extension installed.
.TP
.B \-V, \-\-version
Write version number information to stderr then exit immediately.
No other processing takes place when this option is used.  To see current
revision information while pg_top is running, use the help command \*(lq?\*(rq.
.TP
\fB\-s \fR\fB\fITIME\fR\fR, \fB\-\-set-delay=\fR\fB\fITIME\fR\fR
.I TIME
Set the delay between screen updates to
.I TIME
seconds.  The default delay between updates is \nD seconds.
.TP
\fB\-o \fR\fB\fIFIELD\fR\fR, \fB\-\-order-field=\fR\fB\fIFIELD\fR\fR
Sort the process display area on the specified field.  The field name is
the name of the column as seen in the output, but in lower case.  Likely
values are \*(lqcpu\*(rq, \*(lqsize\*(rq, \*(lqres\*(rq, \*(lqxtime\*(rq and
\*(lqqtime\*(rq, but may vary on different operating systems.  Note that not
all operating systems support this option.
.TP
\fB\-x \fR\fB\fICOUNT\fR\fR, \fB\-\-set-display=\fR\fB\fICOUNT\fR\fR
Show only
.I count
displays, then exit.  A display is considered to be one update of the
screen.  This option allows the user to select the number of displays he
wants to see before
.I pg_top
automatically exits.  For intelligent terminals, no upper limit
is set.  The default is 1 for dumb terminals.
.TP
\fB\-z \fR\fB\fIUSERNAME\fR\fR, \fB\-\-show-username=\fR\fB\fIUSERNAME\fR\fR
Show only those processes owned by
.IR USERNAME .
This option currently only accepts usernames.
.TP
\fB\-h \fR\fB\fIHOST\fR\fR, \fB\-\-host=\fR\fB\fIHOST\fR\fR
Specifies the host name of the machine on which the server is running. If
the value begins with a slash, it is used as the directory for the Unix
domain socket. The default is taken from the PGHOST environment variable,
if set.
.TP
\fB\-p \fR\fB\fIPORT\fR\fR, \fB\-\-port=\fR\fB\fIPORT\fR\fR
Specifies the TCP port or local Unix domain socket file extension on which
the server is listening for connections. Defaults to the PGPORT environment
variable, if set.
.TP
\fB\-U \fR\fB\fIUSERNAME\fR\fR, \fB\-\-username=\fR\fB\fIUSERNAME\fR\fR
User name to connect as.
.TP
\fB\-X
Display I/O activity per process.  This depends on whether the platform pg_top
is run on supports getting I/O statistics per process, or whether the database
system that pg_proctab is installed on supports getting I/O statistics when
pg_top attempts to get operating system statistics remotely.
.PP
Both
.I COUNT
and
.I NUMBER
fields can be specified as \*(lqinfinite\*(rq, indicating that they can
stretch as far as possible.  This is accomplished by using any proper
prefix of the keywords
\*(lqinfinity\*(rq,
\*(lqmaximum\*(rq,
or
\*(lqall\*(rq.
The default for
.I count
on an intelligent terminal is, in fact,
.BI infinity .
.PP
The environment variable
.B PG_TOP
is examined for options before the command line is scanned.  This enables
a user to set his or her own defaults.  The number of processes to display
can also be specified in the environment variable
.BR PG_TOP .
The options
.BR \-C ,
.BR \-I ,
and
.B \-u
are actually toggles.  A second specification of any of these options
will negate the first.  Thus a user who has the environment variable
.B PG_TOP
set to \*(lq\-I\*(rq may use the command \*(lqtop \-I\*(rq to see idle processes.
.SH "INTERACTIVE MODE"
When
.I pg_top
is running in \*(lqinteractive mode\*(rq, it reads commands from the
terminal and acts upon them accordingly.  In this mode, the terminal is
put in \*(lqCBREAK\*(rq, so that a character will be
processed as soon as it is typed.  Almost always, a key will be
pressed when
.I pg_top
is between displays; that is, while it is waiting for
.I time
seconds to elapse.  If this is the case, the command will be
processed and the display will be updated immediately thereafter
(reflecting any changes that the command may have specified).  This
happens even if the command was incorrect.  If a key is pressed while 
.I pg_top
is in the middle of updating the display, it will finish the update and
then process the command.  Some commands require additional information,
and the user will be prompted accordingly.  While typing this information
in, the user's erase and kill keys (as set up by the command
.IR stty )
are recognized, and a newline terminates the input.
.PP
These commands are currently recognized (^L refers to control-L):
.TP
.B ^L
Redraw the screen.
.TP
.B A
Display the actual query plan (EXPLAIN ANALYZE) of the currently running SQL
statement by re-running the SQL statement (prompt for process id.)
.TP
.B C
Toggle the use of color in the display.
.TP
.B c
Toggle the display of the full command line.
.TP
.B d
Change the number of displays to show (prompt for new number).
Remember that the next display counts as one, so typing
.B d1
will make
.I pg_top
show one final display and then immediately exit.
.IP "\fBh\fP\ or\ \fB?\fP"
Display a summary of the commands (help screen).  Version information
is included in this display.
.TP
.B E
Display re-determined execution plan (EXPLAIN) of the SQL statement by a
backend process (prompt for process id.)
.TP
.B i
(or
.BR I )
Toggle the display of idle processes.
.TP
.B L
Display the currently held locks by a backend process (prompt for process
id.)
.TP
.B M
Order by memory utilization.
.TP
.B N
Sort by process id.
.TP
.B n or #
Change the number of processes to display (prompt for new number).
.TP
.B o
Change the order in which the display is sorted.  This command is not
available on all systems.  The sort key names when viewing processes vary
fron system to system but usually include:  \*(lqcpu\*(rq, \*(lqres\*(rq,
\*(lqsize\*(rq, \*(lqxtime\*(rq and \*(lqqtime\*(rq.  The default is cpu.
.TP
.B P
Sort by processor utilization.
.TP
.B Q
Display the currently running query of a backend process (prompt for process
id.)
.TP
.B q
Quit
.IR pg_top.
.TP
.B s
Change the number of seconds to delay between displays
(prompt for new number).
.TP
.B T
Order by time.
.TP
.B u
Display only processes owned by a specific username (prompt for username).
If the username specified is simply \*(lq+\*(rq, then processes belonging
to all users will be displayed.
.SH "THE DISPLAY"
The actual display varies depending on the specific variant of Unix
that the machine is running.  This description may not exactly match
what is seen by pg_top running on this particular machine.  Differences
are listed at the end of this manual entry.
.PP
The top few lines of the display show general information
about the state of the system, including
the last process id assigned to a process (on most systems),
the three load averages,
the current time,
the number of existing processes,
the number of processes in each state
(sleeping, running, starting, zombies, and stopped),
and a percentage of time spent in each of the processor states
(user, nice, system, and idle).
It also includes information about physical and virtual memory allocation.
.PP
The remainder of the screen displays information about individual
processes.  This display is similar in spirit to
.IR ps (1)
but it is not exactly the same.  The columns displayed by pg_top will
differ slightly between operating systems.  Generally, the following
fields are displayed:
.TP
.B PID
The process id.
.TP
.B USERNAME
Username of the process's owner (if
.B \-u
is specified, a UID column will be substituted for USERNAME).
.TP
.B SIZE
Total size of the process (text, data, and stack) given in kilobytes.
.TP
.B RES
Resident memory: current amount of process memory that resides in physical
memory, given in kilobytes.
.TP
.B STATE
Current backend state (typically one of \*(lqidle\*(rq,
\*(lqactive\*(rq, \*(lqidltxn\*(rq, \*(lqfast\*(rq, \*(lqdisabl\*(eq, or
\*(lqstop\*(rq).
.TP
.B XTIME
Elapsed time since the current transactions started.
.TP
.B QTIME
Elapsed time since the current query started.
.TP
.B CPU
Percentage of available cpu time used by this process.
.TP
.B COMMAND
Name of the command that the process is currently running.
.SH COLOR
pg_top supports the use of ANSI color in its output. By default, color is
available but not used.  The environment variable
.B TOPCOLORS
specifies colors to use and conditions for which they should be used.
At the present time, only numbers in the summay display area can be 
colored. In a future version it will be possible to highlight numbers
in the process display area as well.  The environment variable is the
only way to specify color: there is no equivalent command line option.
Note that the environment variable
.B TOPCOLOURS
is also understood. The British spelling takes precedence.  The use of
color only works on terminals that understand and process ANSI color
escape sequences.
.PP
The environment variable is a sequence of color specifications, separated
by colons. Each specification takes the form tag=min,max#code where
.I tag
is the name of the value to check,
.I min
and
.I max
specify a range for the value, and
.I code
is an ANSI color code.  Multiple color codes can be listed and separated
with semi-colons.  A missing
.I min
implies the lowest possible value (usually 0)
and a missing
.I max
implies infinity. The comma must always be present. When specifying numbers
for load averages, they should be multiplied by 100.
For example, the specification
.B 1min=500,1000#31
indicates that a 1 minute load average between
5 and 10 should be displayed in red. Color attributes can be combined.
For example, the specification
.B 5min=1000,#37;41
indicates that a 5 minute load average higher than 10 should be displayed
with white characters on a red background. A special tag named
.I header
is used to control the color of the header for process display.  It should
be specified with no lower and upper limits, specifically
.B header=,#
followed by the ANSI color code.
.PP
You can see a list of color codes recognized by this installation of pg_top
with the
.B \-T
option.  This will also show the current set of tests used for
color highligting, as specified in the environment.
.SH AUTHOR
William LeFebvre
Mark Wong
.SH ENVIRONMENT
.DT
PG_TOP		user-configurable defaults for options.
PG_TOPCOLORS	color specification
.SH BUGS
As with
.IR ps (1),
things can change while
.I pg_top
is collecting information for an update.  The picture it gives is only a
close approximation to reality.
.SH "SEE ALSO"
ps(1),
stty(1),
mem(4),
@MAN_SUPPLEMENT@
